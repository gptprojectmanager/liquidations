# Validation Alert Configuration
# Settings for email notifications and alert triggers

# Alert trigger settings
alerts:
  enabled: true

  # Grades that trigger alerts (C and F)
  trigger_grades:
    - "C"
    - "F"

  # Alert cooldown (minutes) - prevent spam if multiple runs fail
  cooldown_minutes: 30

  # Maximum alerts per day (safety limit)
  max_alerts_per_day: 10

# Email notification settings
email:
  enabled: true

  # SMTP server configuration
  smtp:
    host: "localhost"  # Change to your SMTP server
    port: 587          # 587 for TLS, 465 for SSL, 25 for plain
    use_tls: true      # Use TLS encryption

    # Authentication (optional - set to null if not required)
    username: null     # Set via environment variable: SMTP_USERNAME
    password: null     # Set via environment variable: SMTP_PASSWORD

  # Sender configuration
  from:
    email: "validation@liquidationheatmap.local"
    name: "Liquidation Validation Suite"

  # Recipients
  recipients:
    # Primary recipients (always notified)
    primary:
      - "alerts@example.com"
      - "devops@example.com"

    # Grade-specific recipients
    grade_F:  # Critical failures
      - "oncall@example.com"
      - "engineering-leads@example.com"

    grade_C:  # Warnings
      - "ml-team@example.com"

  # Email template settings
  template:
    include_test_details: true
    include_diagnostics: true
    include_recommendations: true

# Alert channels (future extensions)
channels:
  slack:
    enabled: false
    webhook_url: null  # Set via environment variable: SLACK_WEBHOOK_URL
    channel: "#validation-alerts"

  pagerduty:
    enabled: false
    integration_key: null  # Set via environment variable: PAGERDUTY_KEY
    severity: "error"  # For grade F

  discord:
    enabled: false
    webhook_url: null  # Set via environment variable: DISCORD_WEBHOOK_URL

  sms:
    enabled: false
    provider: "twilio"  # twilio, aws_sns
    recipients: []

# Alert severity mapping
severity:
  grade_A: "info"
  grade_B: "info"
  grade_C: "warning"
  grade_F: "critical"

# Retry settings for failed alert deliveries
retry:
  enabled: true
  max_attempts: 3
  backoff_seconds: 5
  max_backoff_seconds: 60

# Alert storage and history
history:
  enabled: true
  retention_days: 90
  storage_path: "data/processed/alert_history.duckdb"

# Alert aggregation (batch multiple failures)
aggregation:
  enabled: false
  window_minutes: 15  # Group alerts within 15-minute window
  max_batch_size: 5   # Maximum alerts to batch together

# ============================================================================
# Liquidation Zone Alert Configuration
# ============================================================================
# Real-time alerts when BTC price approaches liquidation zones
liquidation_alerts:
  enabled: true

  # Alert thresholds by severity level
  thresholds:
    critical:
      distance_pct: 1.0      # Alert when within 1% of zone
      min_density: 10000000  # Minimum $10M cluster size
    warning:
      distance_pct: 3.0      # Alert when within 3% of zone
      min_density: 5000000   # Minimum $5M cluster size
    info:
      distance_pct: 5.0      # Alert when within 5% of zone
      min_density: 1000000   # Minimum $1M cluster size

  # Rate limiting configuration
  cooldown:
    per_zone_minutes: 60     # 1 alert per zone per hour
    max_daily_alerts: 10     # Max 10 alerts per day (UTC)

  # Data source endpoints
  data_sources:
    price_endpoint: "https://api.binance.com/api/v3/ticker/price?symbol=BTCUSDT"
    heatmap_endpoint: "http://localhost:8000/liquidations/heatmap-timeseries"
    symbol: "BTCUSDT"

  # Notification channels
  channels:
    discord:
      enabled: true
      webhook_url: null      # Set via DISCORD_WEBHOOK_URL env var
      severity_filter:
        - "critical"
        - "warning"
        - "info"

    telegram:
      enabled: false
      bot_token: null        # Set via TELEGRAM_BOT_TOKEN env var
      chat_id: null          # Set via TELEGRAM_CHAT_ID env var
      severity_filter:
        - "critical"
        - "warning"

    email:
      enabled: false
      recipients:
        - "trader@example.com"
      severity_filter:
        - "critical"

  # Alert history storage
  history:
    enabled: true
    db_path: "data/processed/alerts.duckdb"
    retention_days: 90
