{
  "session_id": "337a547f-369c-4624-b0a7-d452aab04ca9",
  "transcript_path": "/home/sam/.claude/projects/-media-sam-1TB-LiquidationHeatmap/337a547f-369c-4624-b0a7-d452aab04ca9.jsonl",
  "hook_event_name": "PreToolUse",
  "tool_name": "Edit",
  "tool_input": {
    "file_path": "/media/sam/1TB/LiquidationHeatmap/src/liquidationheatmap/api/main.py",
    "old_string": "    # AGGREGATE liquidations into price bins to reduce data size for frontend\n    from collections import defaultdict\n\n    logger = logging.getLogger(__name__)\n    logger.info(f\"Raw liquidations: {len(liquidations)}\")\n\n    # Aggregate into $100 price bins, separated by leverage tier\n    # KEY: Use (bin_price, leverage_tier) tuple to preserve leverage separation\n    bin_size = Decimal(\"100\")",
    "new_string": "    # AGGREGATE liquidations into price bins to reduce data size for frontend\n    from collections import defaultdict\n    import math\n\n    logger = logging.getLogger(__name__)\n    logger.info(f\"Raw liquidations: {len(liquidations)}\")\n\n    # Calculate dynamic bin size (py-liquidation-map algorithm)\n    price_min = min(liq.price_level for liq in liquidations)\n    price_max = max(liq.price_level for liq in liquidations)\n    price_range = float(price_max - price_min)\n    tick_degits = 2 - math.ceil(math.log10(price_range))\n    bin_size = Decimal(10 ** (-tick_degits))\n\n    # Aggregate into dynamic price bins, separated by leverage tier\n    # KEY: Use (bin_price, leverage_tier) tuple to preserve leverage separation"
  }
}